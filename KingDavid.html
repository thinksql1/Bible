<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Life of David Bible Study</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter & Lora (for headings) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS for Interactive Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Lora', serif;
        }
        .nav-link {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            border-bottom-color: #1e3a8a;
            color: #1e3a8a;
            transform: translateY(-2px);
        }
        .timeline {
            position: relative;
            padding-left: 2.5rem;
        }
        .timeline::before {
            content: '';
            position: absolute;
            left: 0.5rem;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: #dbeafe; /* blue-100 */
            border-radius: 2px;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2.2rem;
            top: 0.25rem;
            width: 1rem;
            height: 1rem;
            background-color: #3b82f6; /* blue-500 */
            border: 3px solid #dbeafe; /* blue-100 */
            border-radius: 50%;
            z-index: 1;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
        .leaflet-popup-content {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <h1 class="text-xl md:text-3xl font-bold text-blue-900">Life of David: An Enhanced Study</h1>
                </div>
                <nav class="hidden md:flex space-x-6">
                     <a href="#weekly-guides" class="nav-link font-medium text-slate-600">Weekly Guides</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        
        <!-- Weekly Guides Navigation -->
        <section id="weekly-guides" class="mb-8">
             <h2 class="text-3xl font-bold text-center text-blue-900 mb-6">Weekly Study Guides</h2>
            <div id="tab-nav" class="flex flex-wrap justify-center gap-2 md:gap-4 bg-white p-3 rounded-lg shadow-md">
                <!-- Navigation links will be dynamically generated by JavaScript -->
            </div>
        </section>

        <!-- Weekly Content Sections -->
        <div id="weekly-content-container">
            <!-- Content for each week will be dynamically loaded here by JavaScript -->
        </div>
    </main>

    <footer class="text-center py-6 bg-white shadow-inner mt-12">
        <p class="text-slate-500">&copy; 2025 Enhanced Bible Study Tools. All Rights Reserved.</p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {

        const weeksData = [
            // --- WEEK 1 DATA ---
            {
                id: 'week1',
                title: 'Samuel The Faithful Prophet',
                scripture: '1 Samuel 1-8',
                summary: `Our study begins at a tumultuous turning point in Israel's history, as the chaotic era of the Judges concludes. During this period, "every man did that which was right in his own eyes" (Judges 21:25). Weary of internal strife and external threats, the nation clamored for a human king to unite them and fight their battles, making them "like all the nations". This week introduces the dramatic shift from this spiritually bankrupt era to the rise of the prophet Samuel, who served as God's voice and would bridge the gap to the monarchy. The narrative opens not with a political event, but with the intimate, personal anguish of Hannah, a faithful woman suffering under the shame of barrenness. Her fervent, desperate prayer at the Tabernacle in Shiloh is a powerful testament to faith in the face of public scorn and private sorrow. God answers her prayer with the birth of Samuel, whom she dedicates to the Lord's service as a Nazirite for life. Hannah's faithfulness stands in stark contrast to the spiritual decay at the heart of Israel's religious life. The sons of the High Priest, Eli, were corrupt men who abused their office, causing the people to despise God's worship. This corruption culminates in a disastrous military defeat by the Philistines at Ebenezer, where the Israelites foolishly treated the Ark of the Covenant as a magical talisman and lost it in battle. The Ark's subsequent journey through the Philistine cities (Ashdod, Gath, Ekron) is marked by plagues and the toppling of their idol, Dagon, clearly demonstrating that the God of Israel cannot be captured or controlled.`,
                principles: `Key themes established this week include the power of sincere prayer, the severe consequences of sin and failed leadership, and God's absolute sovereignty over human affairs. A foundational principle introduced is the "reversal of human fortune": God lifts up the humble (Hannah) and brings down the proud (the house of Eli), making the barren fruitful and silencing the arrogant. After Samuel leads the people in national repentance at Mizpah, they ultimately reject God's direct rule and demand a human king, seeking a worldly solution to their spiritual problems.`,
                people: [
                    { name: 'Hannah', insight: `As one of Elkanah's two wives, Hannah's life was defined by the grief of her childlessness, worsened by the constant taunting of her rival, Peninnah. She expressed deep anguish and poured out her soul to God at the sanctuary in Shiloh, vowing to dedicate her son to the Lord if her prayer was answered. Her prayer, initially mistaken for drunkenness by Eli, is a model of faithful persistence. As Samuel's mother, she becomes a pivotal figure in Israel's history. Her powerful hymn of praise (1 Samuel 2:1-10) establishes her as a prophetess who understood that her personal deliverance was part of God's larger plan.` },
                    { name: 'Eli', insight: `The High Priest at the Tabernacle in Shiloh, Eli also served as a judge in Israel for forty years. He showed a moment of pastoral kindness to Hannah. However, his legacy is one of tragic failure as a father. He knew of the wickedness of his sons, Hophni and Phinehas, yet failed to restrain them, thereby "honour[ing his] sons above" God. This dereliction of duty led to a divine judgment against his family, fulfilled when his sons were killed and he himself died upon hearing the Ark was captured. His heart "trembled for the ark of God".` },
                    { name: 'Samuel', insight: `The son of Hannah, his name means "heard by God," a testament to his mother's prayer. Given over to service at the Tabernacle from a young age, he lived a life of faithfulness amidst the corruption of Eli's house. God broke a long prophetic silence by speaking directly to Samuel, anointing him as the new spiritual leader of Israel. He became the nation's last and most revered judge. All Israel from Dan to Beersheba knew that Samuel was established as a prophet of the Lord.` }
                ],
                timeline: [
                    { event: "Hannah's Anguish and Prayer", description: "Hannah, barren, is taunted by Peninnah and pours out her soul in prayer at Shiloh." },
                    { event: "Samuel's Birth and Dedication", description: "God answers Hannah's prayer; Samuel is born and dedicated to the Lord's service." },
                    { event: "God Speaks to Samuel", description: "Breaking a long prophetic silence, God speaks directly to young Samuel, outlining judgment against Eli's house." },
                    { event: "Battle of Ebenezer & Ark's Capture", description: "Israel fights the Philistines, loses the battle and the Ark. Eli's sons are slain." },
                    { event: "Ark's Tour in Philistia", description: "The captured Ark brings plagues to Ashdod, Gath, and Ekron, toppling the idol Dagon." },
                    { event: "Ark's Return to Israel", description: "The Philistines send the Ark back. It eventually rests in Kiriath-jearim for twenty years." },
                    { event: "Demand for a King", description: "After national repentance at Mizpah, the people reject God's direct rule and demand a human king." }
                ],
                maps: [
                    {
                        title: "The Ark's Journey Through Philistia",
                        mapData: {
                            center: [31.85, 34.9], zoom: 9,
                            locations: [
                                { coords: [32.125, 34.925], name: 'Ebenezer', desc: 'Israelite camp where the Ark was lost.' },
                                { coords: [31.7700, 34.6942], name: 'Ashdod', desc: 'First Philistine city to house the Ark.' },
                                { coords: [31.6500, 34.7833], name: 'Gath', desc: 'Second Philistine city.' },
                                { coords: [31.7833, 34.8167], name: 'Ekron', desc: 'Third Philistine city.' },
                                { coords: [31.7506, 34.9903], name: 'Beth-shemesh', desc: 'First stop for the Ark\'s return.' },
                                { coords: [31.7975, 35.1086], name: 'Kiriath-jearim', desc: 'The Ark rested here for 20 years.' }
                            ],
                            routes: [ { name: "Ark's Journey", color: '#DC2626', path: [[32.125, 34.925], [31.7700, 34.6942], [31.6500, 34.7833], [31.7833, 34.8167], [31.7506, 34.9903], [31.7975, 35.1086]] } ]
                        }
                    }
                ]
            },
            // --- WEEK 2 DATA ---
            {
                id: 'week2',
                title: 'Saul the Disobedient King',
                scripture: '1 Samuel 10-15',
                summary: `This week chronicles the promising rise and tragic initial fall of Saul, Israel's first human king. Saul, a tall and handsome man from the tribe of Benjamin, was chosen by God. His reign began with a private anointing by Samuel, an act divinely confirmed by three prophetic signs. Despite this, Saul initially exhibited striking humility, even hiding among the supplies during his public selection by lot at Mizpah. He quickly proved his military prowess by rallying a divided Israel to a decisive victory over the Ammonites at Jabesh-gilead. However, Saul's reign was swiftly defined by a pattern of disobedience rooted in fear and impatience. His first critical failure occurred at Gilgal, where, under pressure from a massing Philistine army, Saul unlawfully offered a burnt offering. The second, and final, failure came when he was given a direct command from God to utterly destroy the Amalekites. Saul disobeyed by sparing King Agag and the best of the livestock, ostensibly to sacrifice to the Lord.`,
                principles: `This act of partial obedience was exposed by Samuel as outright rebellion. Saul's excuses—blaming the people and claiming religious motives—were stripped away, revealing a heart that feared man more than God. Samuel delivered the final, devastating verdict: "Because thou hast rejected the word of the LORD, he hath also rejected thee from being king" (1 Samuel 15:23). The central theme is the tragic contrast between the complete, faith-based obedience God requires and the partial, fear-based obedience that amounts to rebellion. Saul's story is a powerful case study in the principle that "to obey is better than sacrifice" (1 Samuel 15:22).`,
                people: [
                    { name: 'Saul', insight: `From the tribe of Benjamin, Saul was chosen by God to be Israel's first king. He was described as a choice young man, goodly, and taller than anyone else. He began his reign with humility and military success, but his character was ultimately defined by impulsiveness and a fear of public opinion that led him to disobey God's direct commands. His excuses for his disobedience revealed a heart that feared man more than God.`},
                    { name: 'Samuel', insight: `As the prophet of God, Samuel anointed Saul and served as his spiritual guide and conscience. He had the painful duty of confronting Saul with the severe consequences of his disobedience. Samuel's deep grief over Saul's failure (1 Samuel 15:11) underscores the tragedy of the path Israel had chosen.`},
                    { name: 'Jonathan', insight: `Saul's son, introduced as a courageous and capable military commander. His faith and bravery in battle (e.g., against the Philistines in 1 Samuel 14:6) served as an early contrast to the fear and disobedience that would later characterize his father's reign.`},
                    { name: 'Agag', insight: `The king of the Amalekites whom God commanded Saul to utterly destroy. Saul's decision to spare Agag's life was a direct defiance of God's command and became the final straw leading to Saul's rejection. The grim scene of Samuel himself "hewing Agag in pieces" at Gilgal demonstrated the non-negotiable nature of God's command.`}
                ],
                timeline: [
                    { event: "Saul's Anointing & Selection", description: "Samuel privately anoints Saul, who is then publicly chosen by lot at Mizpah." },
                    { event: "Victory at Jabesh-gilead", description: "Saul, empowered by the Spirit, rallies Israel and delivers a decisive victory over the Ammonites." },
                    { event: "First Disobedience: Unlawful Sacrifice", description: "At Gilgal, Saul impatiently offers a sacrifice himself, usurping Samuel's role and earning a rebuke." },
                    { event: "War against Amalek", description: "God commands Saul to utterly destroy the Amalekites as vengeance for their past actions." },
                    { event: "Second Disobedience: Partial Obedience", description: "Saul spares King Agag and the best livestock, claiming they were for sacrifice." },
                    { event: "Saul's Rejection", description: "Samuel confronts Saul, declaring 'to obey is better than sacrifice' and that God has rejected him as king." }
                ],
                maps: [
                    {
                        title: "Saul's Campaign to Jabesh-gilead",
                        mapData: {
                            center: [32.15, 35.45], zoom: 9,
                            locations: [
                                { coords: [31.8494, 35.2345], name: 'Gibeah', desc: 'Saul\'s capital.' },
                                { coords: [32.33, 35.43], name: 'Bezek', desc: 'Israelite forces muster here.' },
                                { coords: [32.4578, 35.6322], name: 'Jabesh-gilead', desc: 'City rescued by Saul from the Ammonites.' }
                            ],
                            routes: [{ name: "Campaign to Jabesh-gilead", color: '#059669', path: [[32.33, 35.43], [32.4578, 35.6322]] }]
                        }
                    },
                    {
                        title: "Saul's Campaign Against the Amalekites",
                        mapData: {
                            center: [30.5, 34.5], zoom: 7,
                            locations: [
                                { coords: [31.8494, 35.2345], name: 'Gibeah', desc: 'Saul\'s capital.' },
                                { coords: [31.8844, 35.5503], name: 'Gilgal', desc: 'Site of Saul\'s disobedience.' },
                                { coords: [30.0, 34.0], name: 'Region of Amalek', desc: 'The campaign area stretching "from Havilah to Shur".' }
                            ],
                            routes: [{ name: "Campaign against Amalekites", color: '#D97706', path: [[31.8494, 35.2345], [30.0, 34.0], [31.8844, 35.5503]] }]
                        }
                    }
                ]
            },
            // --- WEEK 3 DATA ---
            {
                id: 'week3',
                title: 'David the Anointed Shepherd',
                scripture: '1 Samuel 16-18',
                summary: `This week marks a seismic shift in Israel's story, moving the focus from the rejected King Saul to God's chosen successor, David. The narrative begins with God sending the prophet Samuel, who was still grieving over Saul's failure, to the town of Bethlehem on a secret mission: to anoint a new king from among the sons of Jesse. This selection process introduces one of the Bible's most profound principles. As Samuel is impressed by the stature of Jesse's eldest son, Eliab, God corrects him with the words, "for the LORD seeth not as man seeth; for man looketh on the outward appearance, but the LORD looketh on the heart" (1 Samuel 16:7). The one chosen is the youngest, David, a shepherd boy, upon whom the Spirit of God comes mightily after his anointing. In a dramatic and divinely orchestrated juxtaposition, as the Spirit of God comes upon David, it departs from Saul, who becomes tormented by "an evil spirit from the LORD". Through what appears to be mere chance but is clearly divine providence, David is brought into the royal court to soothe the king with his harp, also becoming his armor-bearer.`,
                principles: `The narrative's climax occurs in the Valley of Elah, where the Philistine army, spearheaded by their champion Goliath, has paralyzed the Israelite forces with fear. David, visiting his brothers on the front line, is appalled that this "uncircumcised Philistine" is allowed to defy "the armies of the living God". Armed not with armor but with unwavering faith in God's name and a simple shepherd's sling, David defeats the giant, securing a momentous victory for Israel. This heroic act catapults David to national fame, solidifies a deep covenant friendship with Saul's son Jonathan, and wins him the hand of Saul's daughter Michal. Yet, this very success ignites a consuming and murderous jealousy in King Saul, setting the stage for the turbulent years of conflict to come.`,
                people: [
                    { name: 'David', insight: `The youngest of Jesse's eight sons, chosen for his heart. His faith-fueled victory over Goliath transforms him into a national hero and, consequently, the primary target of Saul's envy. He demonstrates unwavering confidence in God.`},
                    { name: 'Goliath', insight: `A Philistine warrior from Gath, representing the pinnacle of worldly power and intimidation. His shocking defeat serves as a powerful symbol of how God's power is perfected in weakness. He curses David by his gods.`},
                    { name: 'Jonathan', insight: `The son of King Saul who forms a deep covenant friendship with David, recognizing his kindred spirit of faith. Their covenant, where Jonathan gives David his own royal robe and armor, is a profound act of loyalty that transcends politics.`},
                    { name: 'Michal', insight: `King Saul's younger daughter who genuinely loved David. Saul exploits this by demanding a gruesome bride price, hoping David will be killed, but David succeeds and she becomes his first wife.`}
                ],
                timeline: [
                    { event: "David Anointed", description: "Samuel secretly anoints David in Bethlehem. The Spirit of the Lord comes upon David powerfully." },
                    { event: "Spirit Departs from Saul", description: "Simultaneously, the Spirit of the Lord departs from Saul, and he is tormented by an evil spirit." },
                    { event: "David Enters Saul's Service", description: "David is brought to Saul's court as a musician and armor-bearer." },
                    { event: "Goliath's Challenge", description: "Goliath defies the armies of Israel in the Valley of Elah for forty days." },
                    { event: "David Confronts Goliath", description: "Armed with a sling and faith, David confronts and kills Goliath, securing a great victory." },
                    { event: "David's Rise to Fame & Saul's Jealousy", description: "David becomes a national hero, but his success causes Saul's jealousy to turn into murderous intent." }
                ],
                maps: [
                    {
                        title: "The Stage for David vs. Goliath",
                        mapData: {
                            center: [31.75, 35.0], zoom: 10,
                            locations: [
                                { coords: [31.7049, 35.2038], name: 'Bethlehem', desc: 'David\'s hometown.' },
                                { coords: [31.8494, 35.2345], name: 'Gibeah', desc: 'Saul\'s capital.' },
                                { coords: [31.6961, 34.9922], name: 'Valley of Elah', desc: 'Site of the standoff and battle.' },
                                { coords: [31.6500, 34.7833], name: 'Gath', desc: 'Goliath\'s hometown.' }
                            ],
                            routes: [ { name: "David's Journey to Court", color: '#22C55E', path: [[31.7049, 35.2038], [31.8494, 35.2345]] } ]
                        }
                    }
                ]
            },
            // --- WEEK 4 DATA ---
            {
                id: 'week4',
                title: 'David the Innocent Fugitive',
                scripture: '1 Samuel 19-31',
                summary: `This week plunges into the darkest period of David's early life, chronicling his long years as a fugitive. Saul's jealousy erupts into open murder attempts, forcing David to flee. His survival depends on a network of supporters like Michal and Jonathan. David's frantic journey takes him to Ramah, then to the priest Ahimelech at Nob, where an act of compassion results in Saul ordering the horrific massacre of the city's priests. David's journey takes him into enemy territory, where he feigns madness to escape Gath, and then into the desolate wilderness of Judah. There, in places like the cave of Adullam, he gathers a loyal band of followers. The moral contrast between Saul and David peaks in two dramatic encounters where David spares Saul's life, refusing to harm "the LORD's anointed." The section concludes with the tragic final battle on Mount Gilboa, where the Philistines crush the Israelite army, killing Jonathan, and the despairing Saul takes his own life.`,
                principles: `David's consistent refusal to take matters into his own hands, despite having the opportunity, demonstrates an extraordinary faith in God's sovereignty and timing. His reliance on God for guidance and protection, even in the most desperate circumstances, stands in stark contrast to Saul's descent into paranoia and reliance on forbidden spiritual counsel. This period forges David's character as a leader who trusts God's justice above his own.`,
                people: [
                     { name: 'David', insight: 'As a man on the run, his character is forged in affliction. He shows resourcefulness (feigning madness), charismatic leadership (gathering an army), and profound faith, consistently inquiring of the Lord and showing remarkable restraint by sparing Saul.'},
                     { name: 'Saul', insight: 'Consumed by paranoia, he devolves into a tyrant. His obsession with hunting David leads him to commit horrific atrocities like the slaughter of the priests at Nob. His reign ends in utter spiritual darkness, consulting a medium at Endor and committing suicide.'},
                     { name: 'Jonathan', insight: 'David\'s unwavering friend, who acts as a protector and encourager, reaffirming his belief that David will be king. His loyalty, even at the cost of his own life, is a powerful example of true friendship.'},
                     { name: 'Abigail', insight: 'The wise wife of the churlish Nabal. Her humble appeal and supply of provisions prevent David from taking vengeful bloodshed into his own hands.'}
                ],
                timeline: [
                    { event: "David Flees Gibeah", description: "With help from Michal and Jonathan, David escapes Saul's murder attempts." },
                    { event: "Massacre at Nob", description: "David receives help from Ahimelech the priest. For this, Saul orders the city of priests to be slaughtered." },
                    { event: "David Gathers Followers", description: "David feigns madness in Gath, then gathers a band of 400-600 men in the Cave of Adullam." },
                    { event: "David Spares Saul (First Time)", description: "In a cave at En-gedi, David finds Saul vulnerable but refuses to harm him, only cutting his robe." },
                    { event: "Abigail's Intervention", description: "The wise Abigail prevents David from taking revenge on the foolish Nabal." },
                    { event: "David Spares Saul (Second Time)", description: "David secretly enters Saul's camp at night and takes his spear and water jug, again sparing his life." },
                    { event: "David in Philistia", description: "David seeks refuge with King Achish of Gath and is given the town of Ziklag." },
                    { event: "Saul's Final Battle", description: "On Mount Gilboa, the Philistines defeat Israel. Saul's sons, including Jonathan, are killed, and Saul takes his own life." }
                ],
                maps: [
                    {
                        title: "David's Initial Flight",
                        mapData: {
                            center: [31.8, 35.0], zoom: 10,
                            locations: [
                                { coords: [31.8494, 35.2345], name: 'Gibeah', desc: 'Starting point of flight.' },
                                { coords: [31.9861, 35.1517], name: 'Ramah (Naioth)', desc: 'First stop with Samuel.' },
                                { coords: [31.795, 35.245], name: 'Nob', desc: 'City of priests, later massacred.' },
                                { coords: [31.6500, 34.7833], name: 'Gath', desc: 'David feigns madness here.' },
                                { coords: [31.655, 35.008], name: 'Cave of Adullam', desc: 'David gathers his loyal army.' },
                            ],
                            routes: [ { name: "Initial Flight Path", color: '#EF4444', path: [[31.8494, 35.2345], [31.9861, 35.1517], [31.795, 35.245], [31.6500, 34.7833], [31.655, 35.008]] } ]
                        }
                    },
                    {
                        title: "Hiding in the Wilderness & Philistia",
                        mapData: {
                            center: [31.4, 34.9], zoom: 9,
                             locations: [
                                { coords: [31.52, 35.12], name: 'Wilderness of Ziph', desc: 'David hides, Ziphites betray him.' },
                                { coords: [31.433, 35.394], name: 'En-gedi', desc: 'David spares Saul in a cave.' },
                                { coords: [31.43, 35.05], name: 'Carmel (of Nabal)', desc: 'Site of Nabal and Abigail.' },
                                { coords: [31.33, 34.62], name: 'Ziklag', desc: 'David\'s base in Philistia, later burned by Amalekites.' },
                                { coords: [32.443, 35.340], name: 'Mount Gilboa', desc: 'Death of Saul and Jonathan.' }
                             ],
                             routes: []
                        }
                    }
                ]
            },
            // --- WEEK 5 DATA ---
            {
                id: 'week5',
                title: 'David the Victorious King',
                scripture: '2 Samuel 1-10',
                summary: `This week marks David's triumphant, though complex, ascent to the throne. The narrative opens not with celebration, but with sorrow. In Ziklag, David learns of the deaths of Saul and Jonathan and leads the nation in mourning. Following God's guidance, David proceeds to Hebron, where the elders of Judah anoint him as their king. This initiates a tense period of national division. Abner, Saul's former commander, establishes Saul's weak son, Ish-bosheth, as king over the northern tribes, sparking a long and costly civil war. After years of conflict, the elders of all the tribes of Israel finally come to Hebron and anoint David king over a united nation. With the kingdom unified, David executes a brilliant strategic move: he conquers the neutral, heavily fortified Jebusite city of Jerusalem and establishes it as his new capital.`,
                principles: `This politically astute decision provides a central, non-tribal seat of government. He then solidifies its importance by making it the nation's religious heart, bringing the Ark of the Covenant into the city with great celebration. This act of piety prompts God to establish the Davidic Covenant (2 Samuel 7), promising David an eternal house, kingdom, and throne. The week concludes with a summary of David's extensive military victories and his kindness to Mephibosheth, Jonathan's son, fulfilling his covenant with Jonathan.`,
                people: [
                    { name: 'David', insight: `Showcases multifaceted leadership as a grieving poet, just ruler, shrewd strategist, brilliant military commander, and pious spiritual leader. He successfully unites a fractured nation.` },
                    { name: 'Joab', insight: `David's nephew and formidable commander. He is fiercely loyal but also ruthless, as seen in his vengeful murder of Abner, highlighting the tension between violence and righteous rule.` },
                    { name: 'Abner', insight: `The powerful commander of Saul's army and kingmaker behind Ish-bosheth. His defection to David could have peacefully united Israel, but he is murdered by Joab.` },
                    { name: 'Ish-bosheth', insight: `A weak and ineffective figurehead whose assassination marks the pathetic end of Saul's dynasty.` }
                ],
                timeline: [
                    { event: "David Mourns Saul", description: "David receives news of Saul's death, mourns deeply, and composes 'The Song of the Bow'." },
                    { event: "King of Judah", description: "David is anointed king over the house of Judah in Hebron, beginning a 7.5-year reign there." },
                    { event: "Civil War", description: "A long war ensues between the house of Saul (led by Abner) and the house of David (led by Joab)." },
                    { event: "King Over All Israel", description: "After the deaths of Abner and Ish-bosheth, all the tribes anoint David king over a united Israel." },
                    { event: "Conquest of Jerusalem", description: "David conquers the Jebusite stronghold of Jerusalem and makes it his capital, 'the City of David'." },
                    { event: "Ark Brought to Jerusalem", description: "David successfully brings the Ark of the Covenant to Jerusalem with great celebration." },
                    { event: "Davidic Covenant", description: "God promises David an eternal house, kingdom, and throne through his offspring (2 Samuel 7)." }
                ],
                maps: [
                    {
                        title: "The Divided Kingdom & Civil War",
                        mapData: {
                            center: [32.0, 35.4], zoom: 8,
                            locations: [
                                { coords: [31.5346, 35.0945], name: 'Hebron', desc: 'David\'s capital over Judah.' },
                                { coords: [32.355, 35.729], name: 'Mahanaim', desc: 'Ish-bosheth\'s capital over Israel.' },
                                { coords: [31.897, 35.202], name: 'Pool of Gibeon', desc: 'Site of a key battle in the civil war.' }
                            ],
                            routes: []
                        }
                    },
                    {
                        title: "Unification & The Ark's Final Journey",
                        mapData: {
                            center: [31.78, 35.15], zoom: 11,
                            locations: [
                                { coords: [31.7975, 35.1086], name: 'Kiriath-jearim', desc: 'Starting point of the Ark\'s journey.' },
                                { coords: [31.7683, 35.2137], name: 'Jerusalem (City of David)', desc: 'The new united capital and final resting place of the Ark.' }
                            ],
                            routes: [{ name: "Ark's Final Journey", color: '#FBBF24', path: [[31.7975, 35.1086], [31.7683, 35.2137]] }]
                        }
                    }
                ]
            },
            // --- WEEK 6 DATA ---
            {
                id: 'week6',
                title: 'David the Troubled Transgressor',
                scripture: '2 Samuel 11-12',
                summary: `This week marks the great moral crisis of David's reign. The narrative opens with a subtle but damning detail: "at the time when kings go forth to battle... David tarried still at Jerusalem". In this moment of abdicated responsibility, David's idleness leads to temptation. From his palace roof, he sees a beautiful woman, Bathsheba, bathing. Consumed by lust, he abuses his royal power to summon her and commits adultery. The initial sin quickly metastasizes. Upon learning that Bathsheba is pregnant, David orchestrates a desperate cover-up. He recalls her husband, Uriah the Hittite—a soldier of impeccable integrity—from the siege of Rabbah. But Uriah's profound loyalty to his comrades thwarts David's plan. David's deception then escalates to premeditated murder, sending a letter—carried by Uriah himself—instructing his death.`,
                principles: `God sends the prophet Nathan to confront the king with a masterful parable. When David, blind to his own guilt, condemns the rich man, Nathan delivers the piercing words: "Thou art the man". Stripped of his defenses, David offers a simple, genuine confession: "I have sinned against the LORD." Nathan assures him of God's forgiveness, but the consequences will be severe and public: the sword will never depart from his house. This section powerfully explores the anatomy of sin, the abuse of power, the necessity of true repentance, and the painful truth that divine forgiveness does not always erase earthly consequences.`,
                people: [
                    { name: 'David', insight: `At the zenith of his power, his actions reveal how even a person "after God's own heart" is capable of profound sin. His response to Nathan's rebuke—immediate, unqualified repentance—is what ultimately separates him from Saul.` },
                    { name: 'Bathsheba', insight: `The wife of Uriah. The narrative highlights the severe power imbalance in her encounter with the king. She later becomes the mother of Solomon.` },
                    { name: 'Uriah the Hittite', insight: `A soldier of immense integrity and loyalty. His noble character makes David's betrayal and murder all the more heinous.` },
                    { name: 'Nathan the Prophet', insight: `Demonstrates extraordinary courage and wisdom. His carefully crafted parable forces David to judge his own actions from a divine perspective.` }
                ],
                timeline: [
                    { event: "David's Neglect of Duty", description: "While kings go to battle, David remains in Jerusalem." },
                    { event: "Adultery with Bathsheba", description: "David sees Bathsheba, sends for her, and commits adultery. She conceives." },
                    { event: "First Cover-up Attempt", description: "David recalls Uriah from battle, but Uriah's integrity thwarts the plan to hide the pregnancy." },
                    { event: "Murder of Uriah", description: "David sends Uriah back to battle with a letter ordering his own death." },
                    { event: "Nathan's Confrontation", description: "Nathan tells David the parable of the rich man and the lamb, then declares, 'Thou art the man'." },
                    { event: "David's Repentance & Consequences", description: "David confesses, 'I have sinned'. Nathan assures him of forgiveness but declares the child will die and the sword will never leave his house." }
                ],
                maps: [
                    {
                        title: "Uriah's Fateful Journey",
                        mapData: {
                            center: [31.88, 35.56], zoom: 8,
                            locations: [
                                { coords: [31.7683, 35.2137], name: 'Jerusalem', desc: 'Site of David\'s sin and the palace.' },
                                { coords: [31.9704, 35.9106], name: 'Rabbah (Amman)', desc: 'The battlefield where Uriah was murdered.' }
                            ],
                            routes: [ { name: "Uriah's Journey", color: '#7C3AED', path: [[31.9704, 35.9106], [31.7683, 35.2137], [31.9704, 35.9106]] } ]
                        }
                    }
                ]
            },
            // --- WEEK 7 DATA ---
            {
                id: 'week7',
                title: 'Absalom the Rebellious Usurper',
                scripture: '2 Samuel 13-19',
                summary: `This week delves into the tragic fulfillment of Nathan's prophecy that the sword would rise from within David's own house. The chain of events is set in motion by a horrific crime: David's firstborn son, Amnon, rapes his half-sister, Tamar. David is furious but fails to administer justice. After two years of cold hatred, Tamar's full brother, Absalom, murders Amnon and flees into exile. After three years, Joab engineers Absalom's return to Jerusalem. Following a further two-year estrangement, Absalom begins a cunning four-year political campaign to undermine David, "stealing the hearts of the men of Israel". At Hebron, Absalom declares himself king, launching a full-scale rebellion. The coup is so successful that David is forced into a humiliating flight from Jerusalem.`,
                principles: `The resulting civil war reaches its climax in the forest of Ephraim, where David's army crushes Absalom's force. Absalom's famous long hair becomes entangled in an oak tree. Despite David's explicit command to "deal gently," Joab kills him without hesitation. The news transforms David's military victory into a moment of profound personal grief. The week's readings conclude with David's difficult and politically fraught return to Jerusalem, navigating the treacherous task of reconciling with the very tribes that had risen up against him.`,
                people: [
                    { name: 'Absalom', insight: `David's handsome son. His character is a toxic mix of legitimate grievance, cold-blooded revenge, and consuming personal ambition. He is a charismatic and manipulative politician.` },
                    { name: 'Amnon', insight: `David's firstborn whose unpunished crime against his half-sister Tamar is the catalyst for the entire tragedy.` },
                    { name: 'Joab', insight: `David's pragmatic commander. He kills Absalom in direct defiance of David's orders, prioritizing the security of the state over the king's personal feelings.` },
                    { name: 'Ahithophel', insight: `David's formerly trusted counselor who defects to Absalom. When his sound strategic advice is thwarted by David's spy, he foresees the rebellion's failure and hangs himself.` }
                ],
                timeline: [
                    { event: "Amnon's Crime", description: "Amnon, David's firstborn, rapes his half-sister Tamar. David fails to act." },
                    { event: "Absalom's Revenge and Exile", description: "After two years, Absalom murders Amnon and flees into exile in Geshur for three years." },
                    { event: "Absalom's Return and Conspiracy", description: "Absalom returns to Jerusalem and, after a two-year estrangement, begins a four-year campaign to steal the people's hearts." },
                    { event: "Absalom's Rebellion", description: "Absalom declares himself king at Hebron, launching a full-scale rebellion." },
                    { event: "David's Flight", description: "David and his loyal followers are forced into a humiliating flight from Jerusalem across the Jordan River." },
                    { event: "Battle in the Forest of Ephraim", description: "David's army defeats Absalom's forces in a decisive battle." },
                    { event: "Absalom's Death", description: "Absalom gets caught in a tree and is killed by Joab, against David's direct command." }
                ],
                maps: [
                    {
                        title: "David's Flight from Absalom",
                        mapData: {
                            center: [32.0, 35.5], zoom: 8,
                            locations: [
                                { coords: [31.7683, 35.2137], name: 'Jerusalem', desc: 'David flees the capital.' },
                                { coords: [31.5346, 35.0945], name: 'Hebron', desc: 'Absalom starts his rebellion here.' },
                                { coords: [31.77, 35.26], name: 'Mount of Olives', desc: 'David ascends weeping.' },
                                { coords: [32.355, 35.729], name: 'Mahanaim', desc: 'David\'s headquarters in exile.' },
                                { coords: [32.2, 35.65], name: 'Forest of Ephraim', desc: 'Site of the final battle.' }
                            ],
                            routes: [
                                { name: "David's Flight", color: '#F97316', path: [[31.7683, 35.2137], [32.355, 35.729]] },
                                { name: "Absalom's Pursuit", color: '#10B981', path: [[31.5346, 35.0945], [31.7683, 35.2137], [32.2, 35.65]] }
                            ]
                        }
                    }
                ]
            },
            // --- WEEK 8 DATA ---
            {
                id: 'week8',
                title: 'Solomon the Wise Son',
                scripture: '1 Kings 1-11',
                summary: `Our final week examines the transfer of power to Solomon, charting Israel's rise to its golden age and the seeds of its eventual downfall. The story opens with an aging King David, whose weakness prompts another son, Adonijah, to make a bid for the throne. Nathan and Bathsheba act quickly, alerting David, who moves decisively to order the immediate and public anointing of Solomon, collapsing the coup. Solomon's reign begins with a swift consolidation of power. Early in his reign, God appears to Solomon in a dream at Gibeon. When offered anything, Solomon humbly asks for an "understanding heart to judge thy people." Pleased, God grants him not only unparalleled wisdom but also the riches and honor he did not ask for.`,
                principles: `The crowning achievement of Solomon's reign is the construction of the magnificent Temple in Jerusalem. He presides over an era of peace and unprecedented prosperity, with a vast trade empire. Yet, the story ends with a profound and tragic warning. To forge political alliances, Solomon married many foreign women—700 wives and 300 concubines. In his old age, "his wives turned away his heart after other gods". This slide into idolatry provokes God's anger. The judgment is declared: the kingdom will be torn apart after his death, a sad and ironic end for the wisest of kings, whose wisdom could not protect him from a divided heart.`,
                people: [
                    { name: 'Solomon', insight: `Begins his reign with a humble prayer for wisdom and builds the Temple, but his heart is turned to idolatry by his many foreign wives, leading to the kingdom's prophesied division.` },
                    { name: 'David', insight: `In his final days, he acts as a powerful kingmaker, ensuring a legitimate transfer of power to Solomon and giving him a final charge of spiritual and political counsel.` },
                    { name: 'Adonijah', insight: `David's eldest surviving son who attempts to seize the throne but is outmaneuvered. His later request to marry Abishag is seen as a renewed claim and leads to his execution.` },
                    { name: 'Queen of Sheba', insight: `A foreign ruler whose visit to witness Solomon's wisdom and wealth exemplifies the peak of Israel's international reputation.` }
                ],
                timeline: [
                    { event: "Adonijah's Coup Attempt", description: "Adonijah attempts to seize the throne as David is old and frail." },
                    { event: "Solomon Anointed King", description: "Nathan and Bathsheba alert David, who orders Solomon's immediate and public anointing at the Gihon Spring." },
                    { event: "Solomon's Prayer for Wisdom", description: "At Gibeon, Solomon humbly asks God for an 'understanding heart,' and God grants him wisdom, riches, and honor." },
                    { event: "Temple Construction", description: "Solomon builds the magnificent Temple in Jerusalem over seven years, followed by his own palace." },
                    { event: "Dedication of the Temple", description: "Solomon dedicates the Temple with a powerful prayer, and the glory of the Lord fills the house." },
                    { event: "Visit of the Queen of Sheba", description: "The Queen of Sheba visits, attesting to Solomon's legendary wisdom and wealth." },
                    { event: "Solomon's Idolatry", description: "In his old age, Solomon's many foreign wives turn his heart to other gods." },
                    { event: "Judgment Declared", description: "God declares that because of his idolatry, the kingdom will be torn from his son." }
                ],
                maps: [
                    {
                        title: "Solomon's International Trade Empire",
                        mapData: {
                            center: [28, 38], zoom: 4,
                            locations: [
                                { coords: [31.778, 35.235], name: 'Jerusalem', desc: 'Solomon\'s capital and commercial hub.' },
                                { coords: [33.27, 35.21], name: 'Tyre', desc: 'Source of cedar, fir, and skilled labor.' },
                                { coords: [15.3694, 44.1942], name: 'Sheba (Yemen)', desc: 'Kingdom of the Queen of Sheba.' },
                                { coords: [29.53, 35.00], name: 'Ezion-geber', desc: 'Solomon\'s key port on the Red Sea for southern trade.' },
                                { coords: [20, 41], name: 'Ophir (Approx. Arabia/Africa)', desc: 'A primary source of high-quality gold.' },
                                { coords: [36, -6], name: 'Tarshish (Approx. Spain)', desc: 'Western Mediterranean destination for Solomon\'s fleet.' }
                            ],
                            routes: [
                                { name: "Queen of Sheba's Journey", color: '#CA8A04', path: [[15.3694, 44.1942], [31.778, 35.235]] },
                                { name: "Trade Route to Ophir", color: '#047857', path: [[29.53, 35.00], [20, 41]] }
                            ]
                        }
                    }
                ]
            }
        ];

        const tabNavContainer = document.getElementById('tab-nav');
        const contentContainer = document.getElementById('weekly-content-container');
        let activeMaps = [];

        function displayWeek(weekData) {
            activeMaps.forEach(map => map.remove());
            activeMaps = [];
            contentContainer.innerHTML = ''; 

            const weekEl = document.createElement('div');
            weekEl.id = weekData.id;
            weekEl.className = 'bg-white p-6 sm:p-8 rounded-lg shadow-xl';
            
            let peopleList = weekData.people.map(p => `<div class="mb-4"><h4 class="font-bold text-lg text-blue-800">${p.name}</h4><p class="text-slate-700">${p.insight}</p></div>`).join('');
            let timelineList = weekData.timeline.map(t => `<div class="timeline-item"><h4 class="font-bold text-md text-blue-700">${t.event}</h4><p class="text-sm text-slate-600">${t.description}</p></div>`).join('');
            let mapHTML = weekData.maps.map((mapInfo, index) => `
                <div class="mt-6">
                    <h4 class="font-semibold text-lg text-center text-blue-800 mb-2">${mapInfo.title}</h4>
                    <div id="map-${weekData.id}-${index}" class="h-96 w-full rounded-lg shadow-md bg-slate-200 border"></div>
                </div>
            `).join('');

            weekEl.innerHTML = `
                <header class="text-center border-b-2 border-blue-100 pb-4 mb-6">
                    <h2 class="text-4xl font-bold text-blue-900">${weekData.title}</h2>
                    <p class="text-xl text-slate-500 italic mt-2">${weekData.scripture}</p>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Left Column: Summary & Principles -->
                    <div class="md:col-span-2 space-y-6">
                        <div>
                            <h3 class="text-2xl font-bold text-blue-900 border-l-4 border-blue-500 pl-3 mb-3">Weekly Summary</h3>
                            <p class="text-slate-700 leading-relaxed">${weekData.summary}</p>
                        </div>
                         <div>
                            <h3 class="text-2xl font-bold text-blue-900 border-l-4 border-blue-500 pl-3 mb-3">Key Principles</h3>
                            <p class="text-slate-700 italic bg-blue-50 p-4 rounded-lg border border-blue-200">${weekData.principles}</p>
                        </div>
                         <div>
                            <h3 class="text-2xl font-bold text-blue-900 border-l-4 border-blue-500 pl-3 mb-3">Key People & Character Insights</h3>
                            <div class="space-y-4">${peopleList}</div>
                        </div>
                    </div>

                    <!-- Right Column: Timeline -->
                    <div class="md:col-span-1">
                        <h3 class="text-2xl font-bold text-blue-900 text-center mb-4">Sequence of Events</h3>
                        <div class="timeline">${timelineList}</div>
                    </div>
                </div>
                
                <!-- Bottom Section: Maps -->
                <div class="mt-10">
                     <h3 class="text-3xl font-bold text-blue-900 text-center border-t-2 border-blue-100 pt-6 mb-4">Key Locations & Movements</h3>
                     <div class="grid grid-cols-1 lg:grid-cols-${weekData.maps.length > 1 ? 2 : 1} gap-6">
                        ${mapHTML}
                     </div>
                </div>
            `;
            contentContainer.appendChild(weekEl);
            
            weekData.maps.forEach((mapInfo, index) => {
                initializeMap(`map-${weekData.id}-${index}`, mapInfo.mapData);
            });
        }

        function initializeMap(mapId, mapData) {
            const map = L.map(mapId, {
                scrollWheelZoom: false
            }).setView(mapData.center, mapData.zoom);
            activeMaps.push(map);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
                subdomains: 'abcd',
                maxZoom: 20
            }).addTo(map);

            mapData.locations.forEach(loc => {
                L.marker(loc.coords).addTo(map)
                    .bindPopup(`<b>${loc.name}</b><br>${loc.desc}`);
            });
            
            if (mapData.routes && mapData.routes.length > 0) {
                 mapData.routes.forEach(route => {
                    L.polyline(route.path, { color: route.color, weight: 4, dashArray: '5, 10' }).addTo(map);
                });
                let allPoints = mapData.locations.map(l => l.coords).concat(mapData.routes.flatMap(r => r.path));
                if(allPoints.length > 0) {
                    map.fitBounds(L.latLngBounds(allPoints), {padding: [50, 50]});
                }
            }

            // This tells the map to re-check its container size after the browser has finished rendering.
            setTimeout(function() {
                map.invalidateSize();
                // We also re-fit the bounds just in case.
                if (mapData.routes && mapData.routes.length > 0) {
                    let allPoints = mapData.locations.map(l => l.coords).concat(mapData.routes.flatMap(r => r.path));
                     if(allPoints.length > 0) {
                        map.fitBounds(L.latLngBounds(allPoints), {padding: [50, 50]});
                    }
                }
            }, 10);
        }
        
        weeksData.forEach((week, index) => {
            const navLink = document.createElement('a');
            navLink.href = `#${week.id}`;
            navLink.textContent = `Week ${index + 1}`;
            navLink.className = 'nav-link font-medium text-slate-600 px-3 py-2 rounded-md cursor-pointer';
            if (index === 0) {
                navLink.classList.add('active');
            }
            navLink.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('#tab-nav a').forEach(link => link.classList.remove('active'));
                navLink.classList.add('active');
                displayWeek(week);
                window.scrollTo({ top: document.getElementById('weekly-guides').offsetTop - 100, behavior: 'smooth' });
            });
            tabNavContainer.appendChild(navLink);
        });
        
        if (weeksData.length > 0) {
            displayWeek(weeksData[0]);
        }
    });
    </script>
</body>
</html>